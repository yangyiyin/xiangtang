<extend name="Public/base"/>
<block name="body">
	<style>
		td{
			vertical-align: middle!important;
		}
	</style>
	<div class="g-wrap">
		<!-- 按钮工具栏 -->
		<div class="u-tab">

		    <ul class="cc">
		      	<li class="current"><a href="javascript:;">当月未填报单位</a></li
		    </ul>
		</div>

		<div class="search_type cc mb10 search-form">
			<div class="mb10">

				机构类型:
				<select name="type" class="type">
					{$cat_options}
				</select>
				&nbsp;&nbsp;&nbsp;&nbsp;
				机构单位:
				<select name="did" class="did">
					<option value="">全部</option>
					{$department_options}
				</select>
				&nbsp;&nbsp;&nbsp;&nbsp;
				<php>
					$checked = I('get.is_no_submit') ? 'checked="checked"' : '';
					$show = I('get.is_no_submit') ? '' : 'style="display: none"';
				</php>
				未提交审核<input type="checkbox" class="is_no_submit" {$checked} name="is_no_submit" value="1">
				&nbsp;&nbsp;&nbsp;&nbsp;
				<di class="year_month" {$show}>
					<select name="year" class="year">
						<php>
							$years = ['请选择'];
							$cur_year = I('get.year') ? I('get.year') : 0;
							for($i = 2016;$i<=date('Y');$i++) {
							$years[] = $i;
							}

							foreach($years as $year){
							$selected = ($year == $cur_year) ? 'selected' : '';
							echo '<option value="'.$year.'" '.$selected.'>'.$year.'</option>';
							}
						</php>
					</select>年
					<select name="month" class="month">
						<php>
							$months = ['请选择',1,2,3,4,5,6,7,8,9,10,11,12];
							$cur_month = I('get.month') ? I('get.month') : 0;
							foreach($months as $month){
							$selected = ($month == $cur_month) ? 'selected' : '';
							echo '<option value="'.$month.'" '.$selected.'>'.$month.'</option>';
							}
						</php>
					</select>月
				</di>
				&nbsp;&nbsp;&nbsp;&nbsp;
				<a class="u-btn" href="javascript:;" id="search" url="{:U('')}">搜索</a>
				<!-- <a href="javascript:;" class="u-btn" onclick="{:U('post/index',array('resetFiter'=>true))}">重置</a> -->
				</span>


			</div>
		</div>


		<br/>
		<p>
			短信内容: <input type="text" name="content" value="{$content}" class="input input-large">
		</p>
		<br/>
		<!-- 数据表格 -->
		<div class="table_list">

			<!--<p>-->
				<!--选择所有: <input type="checkbox" class="c c1" group="1" level="1">-->

			<!--</p>-->

			<table class="biaoge" width="100%">

				<volist name="list" id="type">
					<tr>
						<td rowspan="{$type.num}">{$type.name}<input type="checkbox" class="c c2 g1" group="{$type.group}" level="2"></td>
					</tr>
					<volist name="type['child']" id="unit">
						<tr>
							<td rowspan="{$unit.num}">{$unit.name}<input type="checkbox" class="c c3 g{$type.group}" group="{$unit.group}" level="3"></td>
						</tr>
						<volist name="unit['child']" id="one">
							<tr>
								<td >{$one.name}-{$one.tel}(已催报{$one.count}次)<input type="checkbox" name="ids[]" value="{$one.tel}" class="ids c c4 g{$unit.group}" level="4"></td>
							</tr>
						</volist>
					</volist>
				</volist>

			</table>
		</div>
		<div class="btn_wrap">
			<div class="btn_wrap_pd">
				<button class="btn J_ajax_post confirm" target-form="ids" url='{:U("send")}'>发送催报短信</button>

		    </div>
		</div>


	</div>
</div>
</block>
<block name="script">
<link href="__STATIC__/datetimepicker/css/datetimepicker.css" rel="stylesheet" type="text/css">
<php>if(C('COLOR_STYLE')=='blue_color') echo '<link href="__STATIC__/datetimepicker/css/datetimepicker_blue.css" rel="stylesheet" type="text/css">';</php>
<link href="__STATIC__/datetimepicker/css/dropdown.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="__STATIC__/datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script type="text/javascript" src="__STATIC__/datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
<script type="text/javascript">
$(function(){
	//搜索功能
	$("#search").click(function(){
		var url = $(this).attr('url');
        var query  = $('.search-form').find('input,select').serialize();
        query = query.replace(/(&|^)(\w*?\d*?\-*?_*?)*?=?((?=&)|(?=$))/g,'');
        query = query.replace(/^&/g,'');


        if( url.indexOf('?')>0 ){
            url += '&' + query;
        }else{
            url += '?' + query;
        }
		window.location.href = url;
	});

	/* 状态搜索子菜单 */
	$(".search-form").find(".drop-down").hover(function(){
		$("#sub-sch-menu").removeClass("hidden");
	},function(){
		$("#sub-sch-menu").addClass("hidden");
	});
	$("#sub-sch-menu li").find("a").each(function(){
		$(this).click(function(){
			var text = $(this).text();
			$("#sch-sort-txt").text(text).attr("data",$(this).attr("value"));
			$("#sub-sch-menu").addClass("hidden");
		})
	});

    //回车自动提交
    $('.search-form').find('input').keyup(function(event){
        if(event.keyCode===13){
            $("#search").click();
        }
    });

    $('#time-start').datetimepicker({
        format: 'yyyy-mm-dd',
        language:"zh-CN",
	    minView:2,
	    autoclose:true
    });

    $('#datetimepicker').datetimepicker({
       format: 'yyyy-mm-dd',
        language:"zh-CN",
        minView:2,
        autoclose:true,
        pickerPosition:'bottom-left'
    });


	$('.c').change(function () {
//		var level = $(this).attr('level');
//		level = parseInt(level)+1;
//		$('.c'+level).prop("checked", this.checked);
//		if (level < 4) {
//			$('.c'+level).change();
//		}

		var group = $(this).attr('group');
		if (group) {
			$('.g'+group).prop("checked", this.checked);
			var level = $(this).attr('level');
			if (level < 4) {
				$('.g'+group).change();
			}
		}

	})


});

</script>

	<script>

		$(document).ready(function(){
			$('.type').change(function(){
				var type = $(this).val();
				//获取部门列表
				$.get('{:U("User/get_did")}',{type:type}).success(function(data){

					if (data) {
						data = '<option value="">全部</option>' + data;
						$('.did').html(data);
					}else{
						updateAlert(data.info ,'网络繁忙');
					}
				});

			});

			$('.is_no_submit').click(function() {
				if ($(this).prop("checked")) {
					$('.year_month').show();
				} else {
					$('.year_month').hide();
				}
			});



		});

	</script>
</block>


