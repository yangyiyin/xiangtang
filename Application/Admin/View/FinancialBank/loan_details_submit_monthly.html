<extend name="Public/base"/>

<block name="body">
	<div class="g-wrap">
		<!-- 按钮工具栏 -->
		<div class="u-tab">
			<ul class="cc tab-nav">
				<li class="current"><a href="javascript:;">{$title}</a></li>
				<li ><a href="{:U('add_history_loan_details_submit_monthly')}">添加历史数据</a></li>
			</ul>
		</div>
		<!-- 数据表格 -->
		<div class="tab-content table_list">
			<!-- 表单 -->
			<form id="form" action="{:U('')}" method="post" class="form-horizontal">
				<div id="tab">
					<table class="biaoge">
						<tbody>
						<tr>
							<td colspan="22"><span class="title">贷款明细报表</span><span> (金额单位 万元)</span></td>

						</tr>
						<tr>

							<td colspan="22">

								{:date('Y')}年{:date('m')}月
							</td>
						</tr>
						<tr>
							<td colspan="11">公司全称:</td>

							<td colspan="11">填表人:</td>

						</tr>

						<tr>
							<td colspan="11">
								<select name="all_name">
									<php>
										$list = $departments;
										$cur = $infos[0]['all_name'];
										foreach($list as $li){
										$selected = ($li == $cur) ? 'selected' : '';
										echo '<option value="'.$li.'" '.$selected.'>'.$li.'</option>';
										}
									</php>
								</select>

							</td>
							<td colspan="11">
								<input type="text" class="input input-medium" name="filler_man" value="{$infos[0]['filler_man']}">
							</td>

						</tr>
						<tr>
							<td colspan="22">明细</td>
						</tr>
						<tr>
							<td>合同号:</td>
							<td>企业名称:</td>
							<td>贷款余额（万元）:</td>
							<td>执行年利率:</td>
							<td>自动按钮(法定代表人、联系电话、注册地址、所属镇、所属行业)</td>
							<td>法定代表人（自动）:</td>
							<td>联系电话（自动）:</td>
							<td>注册地址（自动）:</td>
							<td>所属镇（街道）（自动）:</td>
							<td>所属行业（自动）:</td>
							<td>发放日期:</td>
							<td>到期日期:</td>
							<td>担保方式（保证、抵押、质押、信用）:</td>
							<td>信用余额:</td>
							<td>抵押余额:</td>
							<td>质押余额:</td>
							<td>保证余额:</td>
							<td>其中：保证人:</td>
							<td>五级形态（填写：正常、关注、次级、可疑损失）:</td>
							<td>本金逾期天数:</td>
							<td>是否需要地方政府协调配合（逾期、不良贷款需填写）:</td>
							<td>备注:</td>
						</tr>
						<volist name="infos" id="vo">
							<tr>
								<td>
									<input type="text" class="input input-xmedium" name="logs1[]" value="{$vo.Contract}">
								</td>
								<td>
									<input type="text" class="input input-xmedium" name="logs2[]" value="{$vo.Enterprise}">
								</td>
								<td>
									<input type="text" class="input input-xmedium" name="logs3[]" value="{$vo.Loans}">
								</td>
								<td>
									<input type="text" class="input input-xmedium" name="logs4[]" value="{$vo.Interest}">
								</td>
								<td></td>
								<td>
									<input type="text" class="input input-xmedium" name="logs5[]" value="{$vo.Principal}">
								</td>
								<td>
									<input type="text" class="input input-xmedium" name="logs6[]" value="{$vo.Phone}">
								</td>
								<td>
									<input type="text" class="input input-xmedium" name="logs7[]" value="{$vo.Address}">
								</td>

								<td>
									<select name="logs8[]">
										<if condition="$vo['area_options']">
											{$vo['area_options']}
											<else/>
											{$area_options}
										</if>
									</select>
								</td>
								</td>
								<td>
									<input type="text" class="input input-xmedium" name="logs9[]" value="{$vo.Industry}">
								</td>
								<td>
									<input type="text" class="input input-xmedium time-start" name="logs10[]" value="{$vo.Startdate|time_to_date}">
								</td>
								<td>
									<input type="text" class="input input-xmedium time-end" name="logs11[]" value="{$vo.Enddate|time_to_date}">
								</td>
								<td>
									<input type="text" class="input input-xmedium" name="logs12[]" value="{$vo.Guarantee}">
								</td>
								<td>
									<input type="text" class="input input-xmedium" name="logs13[]" value="{$vo.Over_Credit}">
								</td>
								<td>
									<input type="text" class="input input-xmedium" name="logs14[]" value="{$vo.Over_Mortgage}">
								</td>
								<td>
									<input type="text" class="input input-xmedium" name="logs15[]" value="{$vo.Over_Pledge}">
								</td>
								<td>
									<input type="text" class="input input-xmedium" name="logs16[]" value="{$vo.Over_Margin}">
								</td>
								<td>
									<input type="text" class="input input-xmedium" name="logs17[]" value="{$vo.Guarantor}">
								</td>
								<td>
									<select name="logs18[]">
										<if condition="$vo['pattern_options']">
											{$vo['pattern_options']}
											<else/>
											{$pattern_options}
										</if>
									</select>
								</td>
								<td>
									<input type="text" class="input input-xmedium" name="logs19[]" value="{$vo.OverdueDays}">
								</td>
								<td>
									<input placeholder="是或否" type="text" class="input input-xmedium" name="logs20[]" value="{$vo.Coordination}">
								</td>
								<td>
									<input type="text" class="input input-xmedium" name="logs21[]" value="{$vo.Remarks}">
								</td>
								<!---->


								<!--<td>-->
									<!--<input type="text" class="input input-xmedium" name="logs4[]" value="{$vo.Recover}">-->
								<!--</td>-->

								<!--<td>-->
									<!--<input type="text" class="input input-xmedium time-start" name="logs5[]" value="{$vo.Recover_Time|time_to_date}">-->
								<!--</td>-->

								<!--<td>-->
									<!--<select name="logs6[]">-->
										<!--<if condition="$vo['recover_method_options']">-->
											<!--{$vo['recover_method_options']}-->
											<!--<else/>-->
											<!--{$recover_method_options}-->
										<!--</if>-->
									<!--</select>-->

								<!--</td>-->
								<!--<td>-->
									<!--<input type="text" class="input input-xmedium" name="logs7[]" value="{$vo.Remarks}">-->
								<!--</td>-->
								<td><a class="btn del_log">删除</a></td>
							</tr>
						</volist>
						<tr class="add_line"><td colspan="22"><a class="btn add_log">添加</a></td></tr>
						</tbody>
					</table>
				</div>






				<div class="btn_wrap">
					<div class="btn_wrap_pd">
						<if condition="$info['id']">已提交</if><button class="btn submit-btn J_ajax_post" id="submit" type="submit" target-form="form-horizontal"><if condition="$info['id']">修 改<else/>提 交</if></button>
					</div>
				</div>
			</form>
		</div>
	</div>
	</div>
	<link href="__STATIC__/datetimepicker/css/datetimepicker.css" rel="stylesheet" type="text/css">
	<php>if(C('COLOR_STYLE')=='blue_color') echo '<link href="__STATIC__/datetimepicker/css/datetimepicker_blue.css" rel="stylesheet" type="text/css">';</php>
	<link href="__STATIC__/datetimepicker/css/dropdown.css" rel="stylesheet" type="text/css">
	<script type="text/javascript" src="__STATIC__/datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script type="text/javascript" src="__STATIC__/datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
	<script>
		$(document).ready(function() {
			$(document).on('click', '.add_log', function () {
				var add_html = '<tr>'+
						'<td>'+
						'<input type="text" class="input input-xmedium" name="logs1[]">'+
						'</td>'+
						'<td>'+
						'<input type="text" class="input input-xmedium name" name="logs2[]">'+
						'</td>'+
						'<td>'+
						'<input type="text" class="input input-xmedium" name="logs3[]">'+
						'</td>'+
						'<td>'+
						'<input type="text" class="input input-xmedium" name="logs4[]">'+
						'</td>'+
						'<td>'+
						'<input type="text" class="btn auto_fill" value="自动填充">'+
						'</td>'+
						'<td>'+
						'<input type="text" class="input input-xmedium" name="logs5[]">'+
						'</td>'+
						'<td>'+
						'<input type="text" class="input input-xmedium" name="logs6[]">'+
						'</td>'+
						'<td>'+
						'<input type="text" class="input input-xmedium" name="logs7[]">'+
						'</td>'+
						'<td>'+
						'<select name="logs8[]">{$area_options}</select>'+
						'</td>'+
						'<td>'+
						'<input type="text" class="input input-xmedium" name="logs9[]">'+
						'</td>'+
						'<td>'+
						'<input type="text" id="time-start" class="input input-xmedium" name="logs10[]">'+
						'</td>'+
						'<td>'+
						'<input type="text" id="time-end" class="input input-xmedium" name="logs11[]">'+
						'</td>'+
						'<td>'+
						'<input type="text" class="input input-xmedium" name="logs12[]">'+
						'</td>'+
						'<td>'+
						'<input type="text" class="input input-xmedium" name="logs13[]">'+
						'</td>'+
						'<td>'+
						'<input type="text" class="input input-xmedium" name="logs14[]">'+
						'</td>'+
						'<td>'+
						'<input type="text" class="input input-xmedium" name="logs15[]">'+
						'</td>'+
						'<td>'+
						'<input type="text" class="input input-xmedium" name="logs16[]">'+
						'</td>'+
						'<td>'+
						'<input type="text" class="input input-xmedium" name="logs17[]">'+
						'</td>'+
						'<td>'+
						'<select name="logs18[]">{$pattern_options}</select>'+
						'</td>'+
						'<td>'+
						'<input type="text" class="input input-xmedium" name="logs19[]">'+
						'</td>'+
						'<td>'+
						'<input placeholder="是或否" type="text" class="input input-xmedium" name="logs20[]">'+
						'</td>'+
						'<td>'+
						'<input type="text" class="input input-xmedium" name="logs21[]">'+
						'</td>'+

						'<td><a class="btn del_log">删除</a></td>'+
						'</tr>'
				$('.add_line').before(add_html);

				$('.add_line').prev().find("#time-start").datetimepicker({
					format: 'yyyy-mm-dd',
					language:"zh-CN",
					minView:2,
					autoclose:true
				});

				$('.add_line').prev().find("#time-end").datetimepicker({
					format: 'yyyy-mm-dd',
					language:"zh-CN",
					minView:2,
					autoclose:true,
					pickerPosition:'bottom-left'
				});



			});
			$(document).on('click', '.del_log', function () {
				$(this).parents('tr').remove();

			});

			$(document).on('click', '.auto_fill', function () {
				var tr = $(this).parents('tr');
				var name = tr.find('.name').val();
				$.get('{:U("get_enterprise_info")}', {name:name}, function(data){

					if (!data || !data.Legal || !data.Phone || !data.Address || !data.Jurisdictions || !data.Industry) {
						updateAlert('自动信息填充不完整,请手动输入相关自动数据');
					}


					tr.find("input[name='logs5[]']").val(data.Legal);
					tr.find("input[name='logs6[]']").val(data.Phone);
					tr.find("input[name='logs7[]']").val(data.Address);

					tr.find("select[name='logs8[]']").val(data.Jurisdictions);

					tr.find("input[name='logs9[]']").val(data.Industry);

				});

			});

			$('.time-start').datetimepicker({
				format: 'yyyy-mm-dd',
				language:"zh-CN",
				minView:2,
				autoclose:true
			});
			$('.time-end').datetimepicker({
				format: 'yyyy-mm-dd',
				language:"zh-CN",
				minView:2,
				autoclose:true
			});

		});
	</script>
</block>