<extend name="Public/base"/>
<block name="body">
	<div class="g-wrap">
		<!-- 按钮工具栏 -->
		<div class="u-tab">

			<ul class="cc">
				<li class="current"><a href="javascript:;">所有申请</a></li>
			</ul>
		</div>
		<div class="search_type cc mb10 search-form">
			<div class="mb10">

			  &nbsp;姓名：
			  <input type="text" class="input length_2" name="name" style="width:100px;" value="{:I('name')}" >

			  <span class="mr20">状态：
        	<php>
        		$all = (I('get.status'))?'selected':'';
        		$first = (I('get.status')=='1')?'selected':'';
        		$second = (I('get.status')==2)?'selected':'';
				$third = (I('get.status')==99)?'selected':'';
				$forth = (I('get.status')==3)?'selected':'';
        	</php>
	        <select class="select_2 select" id="sch-sort-txt" name="status">
	          	<option value="" >全部</option>
	          	<option value="1" {$first}>待审核</option>
	          	<option value="2" {$second}>已通过</option>
				<option value="99" {$third}>已拒绝</option>
				<option value="3" {$forth}>已完成</option>
	        </select>

			  <a class="u-btn" href="javascript:;" id="search" url="{:U('index')}">搜索</a>
				  <!-- <a href="javascript:;" class="u-btn" onclick="{:U('post/index',array('resetFiter'=>true))}">重置</a> -->
	        </span>
			</div>
		</div>
		<!-- 数据表格 -->
		<div class="table_list">
			<table class="" width="100%">
				<thead>
				<tr>
					<th><input class="check-all" type="checkbox"/></th>
					<th>id</th>
					<th>类型</th>
					<th>信息</th>
					<th>申请时间</th>
					<th >操作</th>

				</tr>
				</thead>
				<tbody>
				<volist name="list" id="vo">
					<tr>
						<td><input class="ids" type="checkbox" name="ids[]" value="{$vo.id}" /></td>
						<td>{$vo.id} </td>
						<td>{$vo.help_cat.title} </td>
						<td>
							<p>姓名:{$vo.name}</p>
							<p>残疾人号:{$vo.id_no}</p>
							<p>住址:{$vo.address}</p>
							<p>电话:{$vo.tel}</p>
							<p>直属姓名:{$vo.directly_name}</p>
							<p>直属电话:{$vo.directly_tel}</p>
						</td>


						<td>
							{$vo.create_time}
						</td>

						<td>
							<if condition="$vo.status == 1">
								<a class="u-btn confirm J_ajax_get" href="{:U('change_status')}/id/{$vo.id}/status/2">通过</a>|
								<a class="u-btn confirm J_ajax_get" href="{:U('change_status')}/id/{$vo.id}/status/99">拒绝</a>
							</if>

							<if condition="$vo.status == 2">
								<a  class="u-btn confirm J_ajax_get" href="{:U('change_status')}/id/{$vo.id}/status/3">完成</a>
							</if>

							<if condition="$vo.status == 2">
								已通过
							</if>

							<if condition="$vo.status == 99">
								已拒绝
							</if>

							<if condition="$vo.status == 3">
								已完成
							</if>

						</td>

					</tr>
				</volist>
				</tbody>
			</table>
		</div>
		<div class="btn_wrap">
			<div class="btn_wrap_pd">
				<a class="btn btn_small J_ajax_get" href="{:U('Index/setKey',array('cid'=>$_GET['menuId'],'title'=>$meta_title))}"><i class="fa fa-heart"></i></a>
				<button  class="btn J_ajax_post confirm" target-form="ids" url='{:U("change_status")}/status/2'>批量通过</button>
				<button  class="btn J_ajax_post confirm" target-form="ids" url='{:U("change_status")}/status/99'>批量拒绝</button>
				<button  class="btn J_ajax_post confirm" target-form="ids" url='{:U("change_status")}/status/3'>批量完成</button>
			</div>
		</div>
		<!-- 分页 -->
		<div class="page">
			{$page_html}
		</div>
	</div>
	</div>

</block>
<block name="script">
	<link href="__STATIC__/datetimepicker/css/datetimepicker.css" rel="stylesheet" type="text/css">
	<php>if(C('COLOR_STYLE')=='blue_color') echo '<link href="__STATIC__/datetimepicker/css/datetimepicker_blue.css" rel="stylesheet" type="text/css">';</php>
	<link href="__STATIC__/datetimepicker/css/dropdown.css" rel="stylesheet" type="text/css">
	<script type="text/javascript" src="__STATIC__/datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script type="text/javascript" src="__STATIC__/datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
	<script type="text/javascript">
		$(function(){
			//搜索功能
			$("#search").click(function(){
				var url = $(this).attr('url');
				var query  = $('.search-form').find('input,select').serialize();
				query = query.replace(/(&|^)(\w*?\d*?\-*?_*?)*?=?((?=&)|(?=$))/g,'');
				query = query.replace(/^&/g,'');


				if( url.indexOf('?')>0 ){
					url += '&' + query;
				}else{
					url += '?' + query;
				}
				window.location.href = url;
			});

			/* 状态搜索子菜单 */
			$(".search-form").find(".drop-down").hover(function(){
				$("#sub-sch-menu").removeClass("hidden");
			},function(){
				$("#sub-sch-menu").addClass("hidden");
			});
			$("#sub-sch-menu li").find("a").each(function(){
				$(this).click(function(){
					var text = $(this).text();
					$("#sch-sort-txt").text(text).attr("data",$(this).attr("value"));
					$("#sub-sch-menu").addClass("hidden");
				})
			});

			//回车自动提交
			$('.search-form').find('input').keyup(function(event){
				if(event.keyCode===13){
					$("#search").click();
				}
			});

			$('#time-start').datetimepicker({
				format: 'yyyy-mm-dd',
				language:"zh-CN",
				minView:2,
				autoclose:true
			});

			$('#datetimepicker').datetimepicker({
				format: 'yyyy-mm-dd',
				language:"zh-CN",
				minView:2,
				autoclose:true,
				pickerPosition:'bottom-left'
			});

			$('.sort_text').on('click',function(){
				$(this).css('display', 'none');
				$(this).next().css('display', '');
			});
			$('.sort_submit').on('click',function(){
				var url = '{:U("remark")}';
				var value = $(this).prev().val();
				var query = {
					id:$(this).attr('iid'),
					remark:value
				}
				$.post(url,query).success(function(data){
					if (data.status==1) {
						updateAlert(data.info ,'alert-success');
						$(this).parent().css('display', 'none');
						$(this).parent().prev().html(value);
						$(this).parent().prev().css('display', '');
					}else{
						updateAlert('网络繁忙~请稍后再试~');
					}
				}.bind(this));

			});
		});

	</script>
</block>


