<extend name="Public/base"/>
<block name="body">
	<style>
		.table table td,.table table th{
			background: #fff;
			border: 1px solid #999;
			padding: 5px;
		}
	</style>
	<div class="g-wrap">
		<!-- 按钮工具栏 -->
		<div class="u-tab">

		    <ul class="cc">
		      	<li class="current"><a href="javascript:;">所有佣金记录</a></li>
		    </ul>
		</div>
	    <div class="search_type cc mb10 search-form">
	      <div class="mb10">
			  &nbsp;用户id：
			  <input type="text" class="input length_2" name="uid" style="width:100px;" value="{:I('uid')}" >
			  &nbsp;服务站名称：
			  <input type="text" class="input length_2" name="entity_title" style="width:100px;" value="{:I('entity_title')}" >
			  时间：
			  <input type="text" name="create_begin" id="time-start" class="input length_2" value="{:I('create_begin')}" style="width:80px;" autocomplete="off" placeholder="起始时间">
			  -
			  <span class="input-append date" id="datetimepicker"><input type="text" id="time-end" name="create_end" class="input input" value="{:I('create_end')}" placeholder="结束时间" /><span class="add-on" style="background:none;border:none;"><i class="icon-th"></i></span></span>
			  &nbsp<a class="u-btn" href="javascript:;" id="search" url="{:U('')}">确定</a>
	        <!-- <a href="javascript:;" class="u-btn" onclick="{:U('post/index',array('resetFiter'=>true))}">重置</a> -->
	        </span>
	      </div>
	    </div>
		<!-- 数据表格 -->
	    <div class="table_list">
			<table class="" width="100%">
		    <thead>
		        <tr>
					<th>服务站名称</th>
					<th>初始金额</th>
					<th>官方充值</th>
					<th>官方扣除</th>
					<th>经销商佣金收入</th>
					<th>交易支出</th>
					<th>提现</th>
					<th>结余金额</th>
					<th>操作</th>
				</tr>
		    </thead>
		    <tbody>
				<volist name="list" id="vo">
				<tr>
					<td>
						{$vo.user.entity_title}
					</td>
					<td>
						{$vo.account_before|format_price}
					</td>
					<td>
						<a class="check_detail show_box" href="javascript:;" tmp_id="detail">
							{$vo.a_sum|format_price}
							<div class="detail_in" style="display: none">
								<table  width="100%">
									<thead>
									<tr>
										<th>摘要</th>
										<th>日期</th>
										<th>操作uid</th>
										<th>备注</th>
										<th>金额</th>

									</tr>
									</thead>
									<tbody>
									<volist name="vo.a" id="log">
										<tr>
											<td>
												{$log.type_desc}
											</td>
											<td>
												{$log.create_time}
											</td>
											<td>
												{$log.op_uid}
											</td>

											<td>
												{$log.remark}
											</td>
											<td>
												{$log.sum|format_price}
											</td>


										</tr>
									</volist>
									</tbody>
								</table>
							</div>
						</a>
					</td>
					<td>
						<a class="check_detail show_box" href="javascript:;" tmp_id="detail">
							{$vo.b_sum|format_price}
							<div class="detail_in" style="display: none">
								<table  width="100%">
									<thead>
									<tr>
										<th>摘要</th>
										<th>日期</th>
										<th>操作uid</th>
										<th>备注</th>
										<th>金额</th>

									</tr>
									</thead>
									<tbody>
									<volist name="vo.b" id="log">
										<tr>
											<td>
												{$log.type_desc}
											</td>
											<td>
												{$log.create_time}
											</td>
											<td>
												{$log.op_uid}
											</td>

											<td>
												{$log.remark}
											</td>
											<td>
												{$log.sum|format_price}
											</td>


										</tr>
									</volist>
									</tbody>
								</table>
							</div>
						</a>
					</td>
					<td>
						<a class="check_detail show_box" href="javascript:;" tmp_id="detail">
							{$vo.c_sum|format_price}
							<div class="detail_in" style="display: none">
								<table  width="100%">
									<thead>
									<tr>
										<th>摘要</th>
										<th>日期</th>
										<th>单据号</th>
										<th>订单金额</th>
										<th>佣金</th>
										<th>金额</th>
									</tr>
									</thead>
									<tbody>
									<volist name="vo.c" id="log">
										<tr>
											<td>
												{$log.type_desc}
											</td>
											<td>
												{$log.create_time}
											</td>
											<td>
												{$log.order.order_no}
											</td>

											<td>
												{$log.order.sum|format_price}
											</td>
											<td>
												{$log.order.dealer_profit|format_price}
											</td>
											<td>
												{$log.sum|format_price}
											</td>

										</tr>
									</volist>
									</tbody>
								</table>
							</div>
						</a>
					</td>
					<td>
						<a class="check_detail show_box" href="javascript:;" tmp_id="detail">
							{$vo.d_sum|format_price}
							<div class="detail_in" style="display: none">
								<table  width="100%">
									<thead>
									<tr>
										<th>摘要</th>
										<th>日期</th>
										<th>单据号</th>
										<th>订单金额</th>
										<th>金额</th>
									</tr>
									</thead>
									<tbody>
									<volist name="vo.d" id="log">
										<tr>
											<td>
												{$log.type_desc}
											</td>
											<td>
												{$log.create_time}
											</td>
											<td>
												{$log.order.order_no}
											</td>

											<td>
												{$log.order.sum|format_price}
											</td>

											<td>
												{$log.sum|format_price}
											</td>

										</tr>
									</volist>
									</tbody>
								</table>
							</div>
						</a>
					</td>
					<td>
						<a class="check_detail show_box" href="javascript:;" tmp_id="detail">
							{$vo.e_sum|format_price}
							<div class="detail_in" style="display: none">
								<table  width="100%">
									<thead>
									<tr>
										<th>摘要</th>
										<th>日期</th>
										<th>操作uid</th>
										<th>备注</th>
										<th>金额</th>

									</tr>
									</thead>
									<tbody>
									<volist name="vo.e" id="log">
										<tr>
											<td>
												{$log.type_desc}
											</td>
											<td>
												{$log.create_time}
											</td>
											<td>
												{$log.op_uid}
											</td>

											<td>
												{$log.remark}
											</td>
											<td>
												{$log.sum|format_price}
											</td>
										</tr>
									</volist>
									</tbody>
								</table>
							</div>
						</a>
					</td>
					<td>
						{$vo.account|format_price}
					</td>
					<td>
						<a class="check_detail show_box" href="javascript:;" tmp_id="detail">
							查看明细
							<div class="detail_in" style="display: none">
								<table  width="100%">
									<thead>
									<tr>
										<th>摘要</th>
										<th>日期</th>
										<th>单据号</th>
										<th>订单金额</th>
										<th>订单佣金</th>
										<th>备注</th>
										<th>金额</th>
										<th>结余金额</th>
									</tr>
									</thead>
									<tbody>
									<volist name="vo.detail_all" id="log">
										<tr>
											<td>
												{$log.type_desc}
											</td>
											<td>
												{$log.create_time}
											</td>
											<td>
												{$log.order.order_no}
											</td>
											<td>
												{$log.order.sum|format_price}
											</td>
											<td>
												{$log.order.dealer_profit|format_price}
											</td>
											<td>
												{$log.remark}
											</td>
											<td>
												{$log.sum|format_price}
											</td>
											<td>
												{$log.account|format_price}
											</td>

										</tr>
									</volist>
									</tbody>
								</table>
							</div>

						</a>
					</td>

				</tr>
				</volist>
			</tbody>
		    </table> 
		</div>
		<div class="btn_wrap">
			<div class="btn_wrap_pd">
				<a class="btn btn_small J_ajax_get" href="{:U('Index/setKey',array('cid'=>$_GET['menuId'],'title'=>$meta_title))}"><i class="fa fa-heart"></i></a>
				<a class="btn btn_small search" href="javascript:;" url="{:U('all_commission')}/export/1">全部导出</a>
				<a href="javascript:;">总计起止时间:{$create_begin} 至 {$create_end}</a>
		    </div>
		</div>
		<!-- 分页 -->
	    <div class="page">
	        {$page_html}
	    </div>
	</div>
</div>
	<div id="detail" class="show_box_temp" style="display:none;position: fixed;min-width: 500px;left: 50%;top:30%;z-index: 1000;background: #ddd;border: 1px solid #000000;padding: 10px">
		<p class="table">

		</p>
		<p style="padding: 10px">

			<a class="u-btn	close_show_box" href="javascript:;">关闭</a>
		</p>
	</div>
</block>
<block name="script">
<link href="__STATIC__/datetimepicker/css/datetimepicker.css" rel="stylesheet" type="text/css">
<php>if(C('COLOR_STYLE')=='blue_color') echo '<link href="__STATIC__/datetimepicker/css/datetimepicker_blue.css" rel="stylesheet" type="text/css">';</php>
<link href="__STATIC__/datetimepicker/css/dropdown.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="__STATIC__/datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script type="text/javascript" src="__STATIC__/datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
<script type="text/javascript">
$(function(){
	//搜索功能
	$("#search").click(function(){
		var url = $(this).attr('url');
        var query  = $('.search-form').find('input,select').serialize();
        query = query.replace(/(&|^)(\w*?\d*?\-*?_*?)*?=?((?=&)|(?=$))/g,'');
        query = query.replace(/^&/g,'');


        if( url.indexOf('?')>0 ){
            url += '&' + query;
        }else{
            url += '?' + query;
        }
		window.location.href = url;
	});
	$(".search").click(function(){
		var url = $(this).attr('url');
		var query  = $('.search-form').find('input,select').serialize();
		query = query.replace(/(&|^)(\w*?\d*?\-*?_*?)*?=?((?=&)|(?=$))/g,'');
		query = query.replace(/^&/g,'');


		if( url.indexOf('?')>0 ){
			url += '&' + query;
		}else{
			url += '?' + query;
		}
		window.location.href = url;
	});
	/* 状态搜索子菜单 */
	$(".search-form").find(".drop-down").hover(function(){
		$("#sub-sch-menu").removeClass("hidden");
	},function(){
		$("#sub-sch-menu").addClass("hidden");
	});
	$("#sub-sch-menu li").find("a").each(function(){
		$(this).click(function(){
			var text = $(this).text();
			$("#sch-sort-txt").text(text).attr("data",$(this).attr("value"));
			$("#sub-sch-menu").addClass("hidden");
		})
	});

    //回车自动提交
    $('.search-form').find('input').keyup(function(event){
        if(event.keyCode===13){
            $("#search").click();
        }
    });

    $('#time-start').datetimepicker({
        format: 'yyyy-mm-dd',
        language:"zh-CN",
	    minView:2,
	    autoclose:true
    });

    $('#datetimepicker').datetimepicker({
       format: 'yyyy-mm-dd',
        language:"zh-CN",
        minView:2,
        autoclose:true,
        pickerPosition:'bottom-left'
    });
	$('.show_box').on('click', function () {
		//console.log($(this).attr('data'));
		$('.show_box_temp').hide();

		var id = $(this).attr('tmp_id');
		$('.table').html($(this).find('.detail_in').html());
		$('#'+id).show();

	});
	$('.close_show_box').on('click',function () {
		$(this).parents('.show_box_temp').hide();
	});


});

</script>
</block>


