<extend name="Public/base"/>
<block name="body">
	<div class="g-wrap">
		<!-- 按钮工具栏 -->
		<div class="u-tab">

		    <ul class="cc">
				<if condition="$is_all">
					<li class="current"><a href="javascript:;">所有单位数据</a></li>
					<else/>
					<li class="current"><a href="javascript:;">本单位数据</a></li>
				</if>
				<if condition="$can_edit">
					<li ><a href="{:U('submit_monthly')}">新增月报填报</a></li>
					<li ><a href="{:U('detail_submit_monthly')}">新增明细月报填报</a></li>
					<li ><a href="{:U('exit_detail_submit_monthly')}">新增退出明细月报填报</a></li>
				</if>

		    </ul>
		</div>
	    <div class="search_type cc mb10 search-form">
	      <div class="mb10">
			  <!--&nbsp;公司全称：-->
			  <!--<input type="text" class="input length_2" name="all_name" style="width:100px;" value="{:I('all_name')}" >-->
			  <select name="year" class="year">
				  <php>
					  $years = ['请选择'];
					  $cur_year = I('get.year') ? I('get.year') : 0;
					  for($i = 2016;$i<=date('Y');$i++) {
					  $years[] = $i;
					  }

					  foreach($years as $year){
					  $selected = ($year == $cur_year) ? 'selected' : '';
					  echo '<option value="'.$year.'" '.$selected.'>'.$year.'</option>';
					  }
				  </php>
			  </select>年
			  <select name="month" class="month">
				  <php>
					  $months = ['请选择',1,2,3,4,5,6,7,8,9,10,11,12];
					  $cur_month = I('get.month') ? I('get.month') : 0;
					  foreach($months as $month){
					  $selected = ($month == $cur_month) ? 'selected' : '';
					  echo '<option value="'.$month.'" '.$selected.'>'.$month.'</option>';
					  }
				  </php>
			  </select>月

			  <if condition="$is_all">
				  &nbsp;&nbsp;&nbsp;&nbsp;填报单位:
				  <select name="all_name" class="all_name">
					  <php>
						  array_unshift($departments,'全部');
						  $cur = I('all_name') ? I('all_name') : '';
						  foreach($departments as $li){
						  $selected = ($li == $cur) ? 'selected' : '';
						  echo '<option value="'.$li.'" '.$selected.'>'.$li.'</option>';
						  }
					  </php>
				  </select>
			  </if>&nbsp;&nbsp;

			  <if condition="!$is_all">
					<span class="mr20">状态：

					<php>

						$first = (I('get.status')==='0')?'selected':'';
						$second = (I('get.status')==1)?'selected':'';
						$third = (I('get.status')==2)?'selected':'';
					</php>
					<select class="select_2 select" id="sch-sort-txt" name="status">
						<option value="" >全部</option>
						<option value="0" {$first}>草稿</option>
						<option value="1" {$second}>已提交</option>
						<option value="2" {$third}>已通过</option>
					</select>
			  </if>&nbsp;&nbsp;
					  <a class="u-btn" href="javascript:;" id="search" url="{:U('')}">搜索</a>
						<!-- <a href="javascript:;" class="u-btn" onclick="{:U('post/index',array('resetFiter'=>true))}">重置</a> -->
					</span>


	      </div>
	    </div>
		<!-- 数据表格 -->
	    <div class="table_list">
			<table class="" width="100%">
		    <thead>
		        <tr>

					<th >日期</th>
					<if condition="$is_all"><th >单位名称</th></if>
					<th >相关报表</th>
					<th >状态</th>
					<th>操作</th>
				</tr>
		    </thead>
		    <tbody>
				<volist name="list" id="vo">
				<tr style="border-bottom: 1px solid #ddd">

					<td>
						{$vo.year}-{$vo.month}
					</td>
					<if condition="$is_all"><td>{$vo.all_name}</td></if>
					<td>
						<table>
							<tr>
								<td>{$vo.year}-{$vo.month}月报</td>
								<td>
									<if condition="$vo['data']">

										<a href="javascript:;" tmp_id="look" class="u-btn show_box">查看

											<div class="look-content" style="display: none">
												<table class="biaoge" style="margin: 0 auto;">
													<tbody>

													<tr>
														<td rowspan="2">已投资项目数:</td>
														<td colspan="2">已投资项目总数:</td>
														<td>
															<input type="text" class="input input-medium" name="Projects" value="{$vo.data.Projects}">
														</td>
													</tr>
													<tr>
														<td colspan="2">其中：属于初创期投资的项目数:</td>
														<td>
															<input type="text" class="input input-medium" name="Projects_su" value="{$vo.data.Projects}">
														</td>
													</tr>
													<tr>
														<td rowspan="2">已投资项目额:</td>
														<td colspan="2">所投资项目总额:</td>
														<td>
															<input type="text" class="input input-medium" name="Amount" value="{$vo.data.Amount}">
														</td>
													</tr>

													<tr>
														<td colspan="2">其中：属于初创期投资的项目投资额:</td>
														<td>
															<input type="text" class="input input-medium" name="Amount_su" value="{$vo.data.Amount_su}">
														</td>
													</tr>

													<tr>
														<td rowspan="3">各类税费:</td>
														<td colspan="2">营业税:</td>
														<td>
															<input type="text" class="input input-medium" name="Tax_B" value="{$vo.data.Tax_B}">
														</td>
													</tr>
													<tr>
														<td colspan="2">所得税:</td>
														<td>
															<input type="text" class="input input-medium" name="Tax_I" value="{$vo.data.Tax_I}">
														</td>
													</tr>
													<tr>
														<td colspan="2">其他税费:</td>
														<td>
															<input type="text" class="input input-medium" name="Tax_O" value="{$vo.data.Tax_O}">
														</td>
													</tr>

													<tr>
														<td rowspan="10">从业人员数量:</td>
														<td rowspan="2">按性别:</td>
														<td>男性:</td>
														<td>
															<input type="text" class="input input-medium" name="Staff_Sub[]" value="{$vo['data']['Staff_Sub'][0]}">
														</td>
													</tr>


													<tr>
														<td>女性:</td>
														<td>
															<input type="text" class="input input-medium" name="Staff_Sub[]" value="{$vo['data']['Staff_Sub'][1]}">
														</td>
													</tr>


													<tr>
														<td rowspan="4">按学历:</td>
														<td>大专及大专以下:</td>
														<td>
															<input type="text" class="input input-medium" name="Staff_Sub[]" value="{$vo['data']['Staff_Sub'][2]}">
														</td>
													</tr>

													<tr>
														<td>本科:</td>
														<td>
															<input type="text" class="input input-medium" name="Staff_Sub[]" value="{$vo['data']['Staff_Sub'][3]}">
														</td>
													</tr>
													<tr>
														<td>硕士研究生:</td>
														<td>
															<input type="text" class="input input-medium" name="Staff_Sub[]" value="{$vo['data']['Staff_Sub'][4]}">
														</td>
													</tr>
													<tr>
														<td>博士及博士以上:</td>
														<td>
															<input type="text" class="input input-medium" name="Staff_Sub[]" value="{$vo['data']['Staff_Sub'][5]}">
														</td>
													</tr>
													<tr>
														<td colspan="2">管理人员:</td>
														<td>
															<input type="text" class="input input-medium" name="Staff_Sub[]" value="{$vo['data']['Staff_Sub'][6]}">
														</td>
													</tr>
													<tr>
														<td colspan="2">劳务派遣制员工:</td>
														<td>
															<input type="text" class="input input-medium" name="Staff_Sub[]" value="{$vo['data']['Staff_Sub'][7]}">
														</td>
													</tr>
													<tr>
														<td colspan="2">持有国内高端从业资格证书的人员:</td>
														<td>
															<input type="text" class="input input-medium" name="Staff_Sub[]" value="{$vo['data']['Staff_Sub'][8]}">
														</td>
													</tr>

													<tr>
														<td colspan="2">持有国外高端从业资格证书的人员:</td>
														<td>
															<input type="text" class="input input-medium" name="Staff_Sub[]" value="{$vo['data']['Staff_Sub'][9]}">
														</td>
													</tr>
													</tbody>
												</table>
											</div>
										</a>
										<if condition="$vo['status'] == 0 && $can_edit">
											|<a class="u-btn" href="{:U('submit_monthly')}/year/{$vo.year}/month/{$vo.month}/all_name/{$vo.all_name}/editing/1" >编辑</a>
										</if>
										<else/>
										<span class="lable_error">未提交</span>
								</if>
									<if condition="$can_edit && !$vo['data']">
										<a class="u-btn" href="{:U('submit_monthly')}/year/{$vo.year}/month/{$vo.month}/all_name/{$vo.all_name}" >新增月报</a>
									</if>
								</td>
							</tr>
							<tr>
								<td>{$vo.year}-{$vo.month}明细报</td>
								<td>

									<if condition="$vo['data_1']">

										<a href="javascript:;" tmp_id="look" class="u-btn show_box">查看
										</a>
										<div class="look-content" style="display: none">
											<table class="biaoge" style="margin: 0 auto;">
												<tbody>

												<tr>
													<td>所投资公司名称:</td>
													<td>管理公司注册地区域:</td>
													<td>投资金额:</td>
													<td>备注:</td>
												</tr>
												<volist name="vo['data_1']" id="vo">
													<tr>
														<td>
															<input type="text" class="input input-medium" name="logs1[]" value="{$vo.Name}">
														</td>
														<td>
															<select name="logs2[]">
																<if condition="$vo['area_options']">
																	{$vo['area_options']}
																	<else/>
																	{$area_options}
																</if>
															</select>
														</td>
														<td>
															<input type="text" class="input input-medium" name="logs3[]" value="{$vo.Amount}">
														</td>
														<td>
															<input type="text" class="input input-medium" name="logs4[]" value="{$vo.Remarks}">
														</td>

													</tr>
												</volist>
												</tbody>
											</table>

											<div class="page">
												{$vo['page_html']}
											</div>

										</div>
										<if condition="$vo['status'] == 0 && $can_edit">
											|<a class="u-btn" href="{:U('detail_submit_monthly')}/year/{$vo.year}/month/{$vo.month}/all_name/{$vo.all_name}/editing/1" >编辑</a>
										</if>
										<else/>
										<span class="lable_error">未提交</span>
									</if>
									<if condition="$can_edit && !$vo['data_1']">
										<a class="u-btn" href="{:U('detail_submit_monthly')}/year/{$vo.year}/month/{$vo.month}/all_name/{$vo.all_name}" >新增明细报</a>
									</if>

								</td>
							</tr>

							<tr>
								<td>{$vo.year}-{$vo.month}退出明细报</td>
								<td>

									<if condition="$vo['data_2']">

										<a href="javascript:;" tmp_id="look" class="u-btn show_box">查看
										</a>
										<div class="look-content" style="display: none">
											<table class="biaoge" style="margin: 0 auto;">
												<tbody>

												<tr>
													<td>退出项目名称:</td>
													<td>退出项目的投资:</td>
													<td>投资项目退出日期:</td>
													<td>原始投资额:</td>
													<td>退出后回收额:</td>
													<td>投资项目退出方式:</td>
												</tr>
												<volist name="$vo['data_2']" id="vo">
													<tr>
														<td>
															<input type="text" class="input input-xmedium" name="logs1[]" value="{$vo.Name}">
														</td>

														<td>
															<input type="text" class="input input-xmedium time-start" name="logs2[]" id="time-start" value="{$vo.Startdate|time_to_date}">
														</td>
														<td>
															<input type="text" class="input input-xmedium time-end" name="logs3[]" id="time-end" value="{$vo.Exitdate|time_to_date}">
														</td>
														<td>
															<input type="text" class="input input-xmedium" name="logs4[]" value="{$vo.Investment}">
														</td>
														<td>
															<input type="text" class="input input-xmedium" name="logs5[]" value="{$vo.Recycling}">
														</td>
														<td>
															<select name="logs6[]">
																<if condition="$vo['exit_method_options']">
																	{$vo['exit_method_options']}
																	<else/>
																	{$exit_method_options}
																</if>
															</select>
														</td>
														<td><a class="btn del_log">删除</a></td>
													</tr>
												</volist>
												</tbody>
											</table>

											<div class="page">
												{$vo['page_html']}
											</div>

										</div>
										<if condition="$vo['status'] == 0 && $can_edit">
											|<a class="u-btn" href="{:U('exit_detail_submit_monthly')}/year/{$vo.year}/month/{$vo.month}/all_name/{$vo.all_name}/editing/1" >编辑</a>
										</if>
										<else/>
										<span class="lable_error">未提交</span>
									</if>
									<if condition="$can_edit && !$vo['data_2']">
										<a class="u-btn" href="{:U('exit_detail_submit_monthly')}/year/{$vo.year}/month/{$vo.month}/all_name/{$vo.all_name}" >新增退出明细报</a>
									</if>

								</td>
							</tr>

						</table>
					</td>

					<td><span class="lable_success">{$vo['status_desc']}</span></td>
					<td>


						<if condition="$vo['status'] == 0 && $can_edit">

							|<a class="u-btn confirm J_ajax_get" href="{:U('submit_monthly_verify_new')}/id/{$vo.id}" >提交审核</a>
						</if>

						<if condition="$vo['status'] == 1 && $can_change_status ">
							|<a class="u-btn confirm J_ajax_get" href="{:U('verify_change_status')}/id/{$vo.id}/status/2" >审核通过</a>

						</if>
						<if condition="$vo['status'] != 0 && $can_change_status">

							|<a class="u-btn confirm J_ajax_get" href="{:U('verify_change_status')}/id/{$vo.id}/status/0" >退回修改</a>
						</if>
					</td>
				</tr>
				</volist>
			</tbody>
		    </table> 
		</div>
		<div class="btn_wrap">
			<div class="btn_wrap_pd">


		    </div>
		</div>
		<!-- 分页 -->
	    <div class="page" no-ajax="1">
	        {$page_html}
	    </div>
	</div>
</div>

	<div id="look" class="show_box_temp" style="max-height:500px;overflow-y:auto;display:none;position: fixed;min-width: 600px;margin-left:-300px;overflow:auto;left: 50%;top:10%;z-index: 999999;background: #ddd;border: 1px solid #000000;padding: 10px">
		<p style="padding: 10px">

		<div class="box-content">

		</div>


			<a class="u-btn	close_show_box" href="javascript:;">关闭</a>
		</p>
	</div>

</block>
<block name="script">
<link href="__STATIC__/datetimepicker/css/datetimepicker.css" rel="stylesheet" type="text/css">
<php>if(C('COLOR_STYLE')=='blue_color') echo '<link href="__STATIC__/datetimepicker/css/datetimepicker_blue.css" rel="stylesheet" type="text/css">';</php>
<link href="__STATIC__/datetimepicker/css/dropdown.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="__STATIC__/datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script type="text/javascript" src="__STATIC__/datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
<script type="text/javascript">
$(function(){
	//搜索功能
	$("#search").click(function(){
		var url = $(this).attr('url');
        var query  = $('.search-form').find('input,select').serialize();
        query = query.replace(/(&|^)(\w*?\d*?\-*?_*?)*?=?((?=&)|(?=$))/g,'');
        query = query.replace(/^&/g,'');


        if( url.indexOf('?')>0 ){
            url += '&' + query;
        }else{
            url += '?' + query;
        }
		window.location.href = url;
	});

	/* 状态搜索子菜单 */
	$(".search-form").find(".drop-down").hover(function(){
		$("#sub-sch-menu").removeClass("hidden");
	},function(){
		$("#sub-sch-menu").addClass("hidden");
	});
	$("#sub-sch-menu li").find("a").each(function(){
		$(this).click(function(){
			var text = $(this).text();
			$("#sch-sort-txt").text(text).attr("data",$(this).attr("value"));
			$("#sub-sch-menu").addClass("hidden");
		})
	});

    //回车自动提交
    $('.search-form').find('input').keyup(function(event){
        if(event.keyCode===13){
            $("#search").click();
        }
    });

    $('#time-start').datetimepicker({
        format: 'yyyy-mm-dd',
        language:"zh-CN",
	    minView:2,
	    autoclose:true
    });

    $('#datetimepicker').datetimepicker({
       format: 'yyyy-mm-dd',
        language:"zh-CN",
        minView:2,
        autoclose:true,
        pickerPosition:'bottom-left'
    });

	$('.show_box').on('click', function () {
		//console.log($(this).attr('data'));
		$('.show_box_temp').hide();

		var id = $(this).attr('tmp_id');
		$('#'+id).show();
		var html = $(this).find('.look-content').html();
		if (!html) {
			var html = $(this).next('.look-content').html();
		}
		$('#'+id).find('.box-content').html(html);
	});
	$('.close_show_box').on('click',function () {
		$(this).parents('.show_box_temp').hide();
	});


});

</script>
	<script>

		$(document).ready(function(){
			$(document).on('click','.num,.prev,.next', function(e){
				if (!$(this).parents('.page').attr('no-ajax')) {
					var href = $(this).attr('href');
					$.get(href,function(data){
						$('#look').find('.box-content').html(data);
					})
					return false;
				} else {

				}

			})
		})
	</script>
</block>


